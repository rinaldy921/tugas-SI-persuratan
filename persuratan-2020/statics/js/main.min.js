var olMapDiv=document.getElementById('olmap');
var popz=document.getElementById('popz');
var contentz=document.getElementById('popup-contentz');
var closerz=document.getElementById('popup-closerz');
var popz2=document.getElementById('popz2');
var contentz2=document.getElementById('popup-contentz2');
var closerz2=document.getElementById('popup-closerz2');
var popz3=document.getElementById('popz3');
var contentz3=document.getElementById('popup-contentz3');
var closerz3=document.getElementById('popup-closerz3');
var container=document.getElementById('popup2');
var content=document.getElementById('popup-content');
var closer=document.getElementById('popup-closer');
var highlightStyleCache={};
var overlay_mohon;
var overlay_mohon_req;
var overlay_hasil_identifikasi;
var iconStyle=new ol.style.Style({fill:new ol.style.Fill({color:'rgba(180,180,180,0.5)'}),stroke:new ol.style.Stroke({color:'rgba(210,34,34,0.6)',width:0}),text:new ol.style.Text({font:'12px Calibri,sans-serif',fill:new ol.style.Fill({color:'#000'}),stroke:new ol.style.Stroke({color:'#fff',width:3})}),image:new ol.style.Icon(({anchor:[0.5,41],anchorOrigin:'top-left',anchorXUnits:'fraction',anchorYUnits:'pixels',src:'statics/images/marker-icon.png'}))});
var iconStyle2=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,41],anchorOrigin:'top-left',anchorXUnits:'fraction',anchorYUnits:'pixels',src:'statics/images/marker_complete.png'}))});
var styl=new ol.style.Style({fill:new ol.style.Fill({color:'rgba(255, 0, 0, 0.6)'}),stroke:new ol.style.Stroke({color:'rgba(210,34,34,0)',width:0}),text:new ol.style.Text({font:'12px Calibri,sans-serif',fill:new ol.style.Fill({color:'#000'}),stroke:new ol.style.Stroke({color:'#fff',width:3})})});
var projection=ol.proj.get('EPSG:3857');
var raster=new ol.layer.Tile({source:new ol.source.MapQuest({layer:'osm'})});
var style=new ol.style.Style({fill:new ol.style.Fill({color:'rgba(255, 255, 255, 0)'}),stroke:new ol.style.Stroke({color:'rgba(0, 0, 255, 0.4)',width:1}),text:new ol.style.Text({font:'12px Calibri,sans-serif',fill:new ol.style.Fill({color:'#000'}),stroke:new ol.style.Stroke({color:'#fff',width:3})})});
var styles=[style];
var style2=new ol.style.Style({fill:new ol.style.Fill({color:'rgba(255, 255, 255, 0)'}),stroke:new ol.style.Stroke({color:'rgba(210,34,34,0)',width:1}),text:new ol.style.Text({font:'12px Calibri,sans-serif',fill:new ol.style.Fill({color:'#000'}),stroke:new ol.style.Stroke({color:'#fff',width:3})})});
var styles2=[style2];
if(typeof google==='object'&&typeof google.maps==='object'){var gmap=new google.maps.Map(document.getElementById('gmap'),{disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false,mapTypeId:google.maps.MapTypeId.HYBRID,});
gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(olMapDiv);
var marker=new google.maps.Marker;
}
var view=new ol.View({center:[0,0],zoom:1,maxZoom:19});
view.on('change:center',function(){var center=ol.proj.transform(view.getCenter(),'EPSG:3857','EPSG:4326');
if(typeof gmap!=='undefined'){gmap.setCenter(new google.maps.LatLng(center[1],center[0]));
}});
view.on('change:resolution',function(){if(typeof gmap!=='undefined'){gmap.setZoom(view.getZoom());
}});
var map=new ol.Map({interactions:ol.interaction.defaults({altShiftDragRotate:false,dragPan:false,rotate:false}).extend([new ol.interaction.DragPan({kinetic:null})]),target:olMapDiv,view:view});
var overlay=new ol.Overlay(({element:container,autoPan:true,autoPanAnimation:{duration:250}}));
closer.onclick=function(){overlay.setPosition(undefined);
closer.blur();
return false;
};
map.addOverlay(overlay);
var featureOverlay=new ol.layer.Vector({source:new ol.source.Vector(),map:map,style:function(feature,resolution){var text=resolution<5000?feature.get('name'):'';
if(!highlightStyleCache[text]){highlightStyleCache[text]=[new ol.style.Style({stroke:new ol.style.Stroke({color:'#000000',width:4}),fill:new ol.style.Fill({color:'rgba(255,255,0,0.1)',width:1}),text:new ol.style.Text({font:'12px Calibri,sans-serif',text:text,fill:new ol.style.Fill({color:'#000'}),stroke:new ol.style.Stroke({color:'#f00',width:3})})})];
}
return highlightStyleCache[text];
}});
var displayFeatureInfo=function(pixel){var features=[];
map.forEachFeatureAtPixel(pixel,function(feature,layer){features.push(feature);
});
var feature=map.forEachFeatureAtPixel(pixel,function(feature,layer){return feature;
});
if(features.length>0){map.getTarget().style.cursor='pointer';
features.name;
}else{map.getTarget().style.cursor='';
}};
var sorcez2=new ol.source.Vector({});
var vectz2=new ol.layer.Vector({source:sorcez2,style:iconStyle});
var source_hasil=new ol.source.Vector({});
var vector_hasil=new ol.layer.Vector({source:source_hasil,style:iconStyle2});
map.on('pointermove',function(evt){if(evt.dragging){return;
}
var pixel=map.getEventPixel(evt.originalEvent);
displayFeatureInfo(pixel);
});
function initializez(){
  var tete=$('.check-nip').children().children();
  for(i=0;i<tete.length;i++){
    tete[i].checked=true;
  }
// document.getElementById('check1').checked=true;
// document.getElementById('check2').checked=true;
// document.getElementById('check3').checked=true;
  if(typeof permohonan!=='undefined'){if(permohonan.length>0){document.getElementById('check4').checked=true;
}}
if(typeof hasil_identifikasi!=='undefined'){if(hasil_identifikasi.length>0){document.getElementById('check_hasil').checked=true;
}}
var cariz=$('input[name="cariz"]:checked').val();
if(cariz=='0'){nama();
}}
function geocodeLatLng(geocoder,map,infowindow){var input=document.getElementById('pac-input').value;
var latlngStr=input.split(',',2);
var latlng={lat:parseFloat(latlngStr[0]),lng:parseFloat(latlngStr[1])};
geocoder.geocode({'location':latlng},function(results,status){if(status===google.maps.GeocoderStatus.OK){if(results[1]){gmap.fitBounds(results[0].geometry.viewport);
view.setCenter(ol.proj.transform([parseFloat(latlngStr[1]),parseFloat(latlngStr[0])],'EPSG:4326','EPSG:3857'))
gmap.setZoom(11);
view.setZoom(gmap.getZoom());
marker.setMap(null);
marker.setMap(gmap);
marker.setPosition(latlng);
}else{window.alert('No results found');
}}else{window.alert('Geocoder failed due to: '+status);
}});
}
function nama(){var input=document.getElementById('pac-input');
var searchBox=new google.maps.places.SearchBox(input);
gmap.addListener('bounds_changed',function(){searchBox.setBounds(gmap.getBounds());
});
searchBox.addListener('places_changed',function(){var places=searchBox.getPlaces();
if(places.length===0){return;
}
var bounds=new google.maps.LatLngBounds();
places.forEach(function(place){alert(place.geometry);
var icon={url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};
markers.push(new google.maps.Marker({map:gmap,title:place.name,position:place.geometry.location}));
if(place.geometry.viewport){bounds.union(place.geometry.viewport);
}else{bounds.extend(place.geometry.location);
}
view.setCenter(ol.proj.transform([place.geometry.location.lng(),place.geometry.location.lat()],'EPSG:4326','EPSG:3857'))});
gmap.fitBounds(bounds);
view.setZoom(gmap.getZoom());
});
}
function showPermohonan(){overlay_mohon_req.setPosition(undefined);
if(vectz2.getVisible()===true){vectz2.setVisible(false);
}else{vectz2.setVisible(true);
}}
function showHasilIdentifikasi(){overlay_hasil_identifikasi.setPosition(undefined);
if(vector_hasil.getVisible()===true){vector_hasil.setVisible(false);
}else{vector_hasil.setVisible(true);
}}
// function fit(){view.setCenter([12941706.133019758,-74113.31276709272]);
// view.setZoom(5);
// }
function mtungul(t){overlay_mohon.setPosition(undefined);
for(i=0;
i<vect.length;
i++){if(i===t){if(vect[i].getVisible()===true){vect[i].setVisible(false);
}else{vect[i].setVisible(true);
}}}}
function rkuTile(c) {
    for (i = 0;
 i < tiled.length;
 i++) {
        if (i === c) {
            if (tiled[i].getVisible() === true) {
                tiled[i].setVisible(false);

            } else {
                tiled[i].setVisible(true);

            }
        }
    }
}

function iupTile(c) {
    for (i = 0;
 i < tiledIup.length;
 i++) {
        if (i === c) {
            if (tiledIup[i].getVisible() === true) {
                tiledIup[i].setVisible(false);

            } else {
                tiledIup[i].setVisible(true);

            }
        }
    }
}

function tbTile(c) {
    for (i = 0;
 i < tiledTb.length;
 i++) {
        if (i === c) {
            if (tiledTb[i].getVisible() === true) {
                tiledTb[i].setVisible(false);

            } else {
                tiledTb[i].setVisible(true);

            }
        }
    }
}

function rktTile(c) {
    for (i = 0;
 i < tiledRkt.length;
 i++) {
        if (i === c) {
            if (tiledRkt[i].getVisible() === true) {
                tiledRkt[i].setVisible(false);

            } else {
                tiledRkt[i].setVisible(true);

            }
        }
    }
}
function getCenterOfExtent(Extent){
    var X = Extent[0] + (Extent[2]-Extent[0])/2;
    var Y = Extent[1] + (Extent[3]-Extent[1])/2;
    return [parseFloat(X), parseFloat(Y)];
}
function cariProvinsi(input) {
    if(input == 'Pilih Provinsi...') return false;
    var geocoder = new google.maps.Geocoder;
    geocoder.geocode({'address': input}, function (results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
            gmap.fitBounds(results[0].geometry.viewport);
            view.setCenter(ol.proj.transform([parseFloat(results[0].geometry.location.lng()), parseFloat(results[0].geometry.location.lat())], 'EPSG:4326', 'EPSG:3857'))
            gmap.setZoom(8);
            view.setZoom(gmap.getZoom());
            marker.setMap(null);
            marker.setMap(gmap);
            marker.setPosition(results[0].geometry.location);
        } else {
            window.alert('Geocoder failed due to: ' + status);
        }
    });
}

/**
* Renders a progress bar.
* @param {Element} el The target element.
* @constructor
*/
function Progress(el) {
this.el = el;
this.loading = 0;
this.loaded = 0;
}


/**
* Increment the count of loading tiles.
*/
Progress.prototype.addLoading = function() {
if (this.loading === 0) {
  this.show();
}
++this.loading;
this.update();
};


/**
* Increment the count of loaded tiles.
*/
Progress.prototype.addLoaded = function() {
var this_ = this;
setTimeout(function() {
  ++this_.loaded;
  this_.update();
}, 100);
};


/**
* Update the progress bar.
*/
Progress.prototype.update = function() {
var width = (this.loaded / this.loading * 100).toFixed(1) + '%';
this.el.style.width = width;
if (this.loading === this.loaded) {
  this.loading = 0;
  this.loaded = 0;
  var this_ = this;
  setTimeout(function() {
    this_.hide();
  }, 500);
}
};


/**
* Show the progress bar.
*/
Progress.prototype.show = function() {
this.el.style.visibility = 'visible';
};


/**
* Hide the progress bar.
*/
Progress.prototype.hide = function() {
if (this.loading === this.loaded) {
  this.el.style.visibility = 'hidden';
  this.el.style.width = 0;
}
};

var progress = new Progress(document.getElementById('progress'));